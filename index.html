<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3A Softwares - Support</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!-- Custom SCSS compiled to CSS -->
    <link rel="stylesheet" href="css/main.css" />
  </head>
  <body>
    <!-- Dashboard Page (shown directly - auth handled by shell-app) -->
    <div id="dashboardPage" class="page active">
      <!-- Sidebar -->
      <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
          <img
            class="logo"
            src="https://res.cloudinary.com/dpdfyou3r/image/upload/v1767265363/logo/3A_gczh29.png"
            alt="User"
          />
          <h3>3A Support</h3>
        </div>
        <ul class="sidebar-menu">
          <li class="active" data-page="dashboard">
            <i class="bi bi-speedometer2"></i>
            <span>Dashboard</span>
          </li>
          <li data-page="tickets">
            <i class="bi bi-ticket-detailed"></i>
            <span>All Tickets</span>
            <span class="badge bg-primary" id="ticketCount">0</span>
          </li>
          <li data-page="newTicket">
            <i class="bi bi-plus-circle"></i>
            <span>Create Ticket</span>
          </li>
          <li data-page="users">
            <i class="bi bi-people"></i>
            <span>Users</span>
          </li>
          <li data-page="reports">
            <i class="bi bi-graph-up"></i>
            <span>Reports</span>
          </li>
        </ul>
        <div class="sidebar-footer">
          <button class="btn btn-outline-light w-100" id="logoutBtn">
            <i class="bi bi-box-arrow-left me-2"></i>Logout
          </button>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Top Navbar -->
        <nav class="top-navbar">
          <button class="btn btn-link" id="sidebarToggle">
            <i class="bi bi-list"></i>
          </button>
          <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" placeholder="Search tickets..." id="globalSearch" />
          </div>
          <div class="navbar-right">
            <div class="notifications dropdown">
              <button class="btn btn-link" data-bs-toggle="dropdown">
                <i class="bi bi-bell"></i>
                <span class="badge bg-danger" id="notificationBadge">0</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><h6 class="dropdown-header">Notifications</h6></li>
                <li id="notificationList">
                  <a class="dropdown-item text-muted" href="#">No new notifications</a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item text-center"
                    href="#"
                    onclick="event.preventDefault(); showPage('tickets'); updateActiveMenuItem('tickets');"
                    >View all tickets</a
                  >
                </li>
              </ul>
            </div>
            <div class="user-profile dropdown">
              <button class="btn btn-link" data-bs-toggle="dropdown">
                <img
                  id="userAvatar"
                  src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff"
                  alt="User"
                />
                <span id="userName">Loading...</span>
                <i class="bi bi-chevron-down"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="#" id="logoutDropdown"
                    ><i class="bi bi-box-arrow-left me-2"></i>Logout</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </nav>

        <!-- Content Area -->
        <div class="content-area">
          <!-- Dashboard Content -->
          <div id="dashboardContent" class="content-section active">
            <div class="page-header">
              <h2>Dashboard</h2>
              <p id="welcomeMessage">Welcome back! Here's your support overview.</p>
            </div>

            <!-- Stats Cards -->
            <div class="row stats-cards">
              <div class="col-md-3">
                <div class="stat-card stat-total">
                  <div class="stat-icon">
                    <i class="bi bi-ticket-detailed"></i>
                  </div>
                  <div class="stat-info">
                    <h3 id="totalTickets">0</h3>
                    <p>Total Tickets</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card stat-open">
                  <div class="stat-icon">
                    <i class="bi bi-folder2-open"></i>
                  </div>
                  <div class="stat-info">
                    <h3 id="openTickets">0</h3>
                    <p>Open Tickets</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card stat-progress">
                  <div class="stat-icon">
                    <i class="bi bi-hourglass-split"></i>
                  </div>
                  <div class="stat-info">
                    <h3 id="inProgressTickets">0</h3>
                    <p>In Progress</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card stat-resolved">
                  <div class="stat-icon">
                    <i class="bi bi-check-circle"></i>
                  </div>
                  <div class="stat-info">
                    <h3 id="resolvedTickets">0</h3>
                    <p>Resolved</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- My Tickets -->
            <div class="row mt-4">
              <div class="col-md-8">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="bi bi-person-badge me-2"></i>My Tickets</h5>
                    <a href="#" class="btn btn-sm btn-outline-primary" onclick="showPage('tickets')"
                      >View All</a
                    >
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Subject</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Created</th>
                          </tr>
                        </thead>
                        <tbody id="userTicketsTable">
                          <!-- Dynamic content -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h5><i class="bi bi-pie-chart me-2"></i>Ticket Distribution</h5>
                  </div>
                  <div class="card-body">
                    <div class="priority-chart">
                      <div class="priority-item">
                        <span class="priority-label">High</span>
                        <div class="progress">
                          <div
                            class="progress-bar bg-danger"
                            id="highPriorityBar"
                            style="width: 0%"
                          ></div>
                        </div>
                        <span class="priority-count" id="highCount">0</span>
                      </div>
                      <div class="priority-item">
                        <span class="priority-label">Medium</span>
                        <div class="progress">
                          <div
                            class="progress-bar bg-warning"
                            id="mediumPriorityBar"
                            style="width: 0%"
                          ></div>
                        </div>
                        <span class="priority-count" id="mediumCount">0</span>
                      </div>
                      <div class="priority-item">
                        <span class="priority-label">Low</span>
                        <div class="progress">
                          <div
                            class="progress-bar bg-success"
                            id="lowPriorityBar"
                            style="width: 0%"
                          ></div>
                        </div>
                        <span class="priority-count" id="lowCount">0</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tickets Content -->
          <div id="ticketsContent" class="content-section">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2>All Tickets</h2>
                <p>Manage and resolve customer support tickets</p>
              </div>
              <button class="btn btn-primary" onclick="showPage('newTicket')">
                <i class="bi bi-plus-lg me-2"></i>New Ticket
              </button>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-3">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="filterStatus">
                      <option value="">All Status</option>
                      <option value="open">Open</option>
                      <option value="in-progress">In Progress</option>
                      <option value="resolved">Resolved</option>
                      <option value="closed">Closed</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Priority</label>
                    <select class="form-select" id="filterPriority">
                      <option value="">All Priority</option>
                      <option value="high">High</option>
                      <option value="medium">Medium</option>
                      <option value="low">Low</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="filterCategory">
                      <option value="">All Categories</option>
                      <option value="technical">Technical</option>
                      <option value="billing">Billing</option>
                      <option value="general">General</option>
                      <option value="feature">Feature Request</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Search</label>
                    <input
                      type="text"
                      class="form-control"
                      id="ticketSearch"
                      placeholder="Search tickets..."
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Tickets Table -->
            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th><input type="checkbox" class="form-check-input" id="selectAll" /></th>
                        <th>Ticket ID</th>
                        <th>Subject</th>
                        <th>Customer</th>
                        <th>Category</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="ticketsTableBody">
                      <!-- Dynamic content -->
                    </tbody>
                  </table>
                </div>
                <!-- Pagination -->
                <nav class="mt-3">
                  <ul class="pagination justify-content-center" id="ticketsPagination">
                    <!-- Dynamic pagination -->
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <!-- New Ticket Content -->
          <div id="newTicketContent" class="content-section">
            <div class="page-header">
              <h2>Create New Ticket</h2>
              <p>Submit a new support request</p>
            </div>

            <div class="card">
              <div class="card-body">
                <form id="newTicketForm">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="ticketCustomer" class="form-label">Customer Name *</label>
                      <input type="text" class="form-control" id="ticketCustomer" required />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="ticketEmail" class="form-label">Customer Email *</label>
                      <input type="email" class="form-control" id="ticketEmail" required />
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="ticketSubject" class="form-label">Subject *</label>
                    <input type="text" class="form-control" id="ticketSubject" required />
                  </div>
                  <div class="row">
                    <div class="col-md-4 mb-3">
                      <label for="ticketCategory" class="form-label">Category *</label>
                      <select class="form-select" id="ticketCategory" required>
                        <option value="">Select Category</option>
                        <option value="technical">Technical Issue</option>
                        <option value="billing">Billing</option>
                        <option value="general">General Inquiry</option>
                        <option value="feature">Feature Request</option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-3">
                      <label for="ticketPriority" class="form-label">Priority *</label>
                      <select class="form-select" id="ticketPriority" required>
                        <option value="">Select Priority</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-3">
                      <label for="ticketAssignee" class="form-label">Assign To</label>
                      <select class="form-select" id="ticketAssignee">
                        <option value="">Unassigned</option>
                        <!-- Dynamic options populated by JS -->
                      </select>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="ticketDescription" class="form-label">Description *</label>
                    <textarea
                      class="form-control"
                      id="ticketDescription"
                      rows="5"
                      required
                    ></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="ticketAttachment" class="form-label">Attachments</label>
                    <input type="file" class="form-control" id="ticketAttachment" multiple />
                  </div>
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-send me-2"></i>Submit Ticket
                    </button>
                    <button type="reset" class="btn btn-outline-secondary">
                      <i class="bi bi-x-lg me-2"></i>Cancel
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Users Content -->
          <div id="usersContent" class="content-section">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2>Support Team</h2>
                <p>View support agents and their ticket statistics</p>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>User</th>
                        <th>Role</th>
                        <th>Assigned</th>
                        <th>Resolved</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody id="usersTableBody">
                      <!-- Dynamic content -->
                    </tbody>
                  </table>
                </div>
                <!-- Pagination -->
                <nav class="mt-3">
                  <ul class="pagination justify-content-center" id="usersPagination">
                    <!-- Dynamic pagination -->
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <!-- Reports Content -->
          <div id="reportsContent" class="content-section">
            <div class="page-header">
              <h2>Reports & Analytics</h2>
              <p>View support performance metrics</p>
            </div>

            <div class="row">
              <div class="col-md-6 mb-4">
                <div class="card">
                  <div class="card-header">
                    <h5>Ticket Resolution Time</h5>
                  </div>
                  <div class="card-body">
                    <div class="report-stat">
                      <div class="report-number" id="avgResolutionTime">--</div>
                      <div class="report-label">Average Resolution Time</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 mb-4">
                <div class="card">
                  <div class="card-header">
                    <h5>Resolution Rate</h5>
                  </div>
                  <div class="card-body">
                    <div class="report-stat">
                      <div class="report-number" id="resolutionRate">--</div>
                      <div class="report-label">Tickets Resolved</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Ticket Detail Modal -->
    <div class="modal fade" id="ticketDetailModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Ticket Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="ticketDetailBody">
            <!-- Dynamic content -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-success" id="resolveTicketBtn">
              <i class="bi bi-check-circle me-2"></i>Mark as Resolved
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="successToast" class="toast" role="alert">
        <div class="toast-header bg-success text-white">
          <i class="bi bi-check-circle me-2"></i>
          <strong class="me-auto">Success</strong>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="js/app.js"></script>
  </body>
</html>
